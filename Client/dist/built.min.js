var ChatClient=angular.module("ChatClient",["ngRoute"]);angular.module("ChatClient").config(["$routeProvider",function(a){a.when("/login",{templateUrl:"Views/login.html",controller:"LoginController"}).when("/rooms/:user/",{templateUrl:"Views/rooms.html",controller:"RoomsController"}).when("/room/:user/:room/",{templateUrl:"Views/room.html",controller:"RoomController"}).otherwise({redirectTo:"/login"})}]),angular.module("ChatClient").directive("onFinishRender",["$timeout",function(a){return{restrict:"A",link:function(b){b.$last===!0&&a(function(){b.$emit("ngRepeatFinished")})}}}]),angular.module("ChatClient").controller("LoginController",["$scope","$location","$rootScope","$routeParams","socket",function(a,b,c,d,e){a.errorMessage="",a.nickname="",a.activeusers=[],a.login=function(){""===a.nickname?a.errorMessage="Please choose a nick-name before continuing!":e.emit("adduser",a.nickname,function(c){c?b.path("/rooms/"+a.nickname):a.errorMessage="This nick-name is already taken!"})},$("#nickname").keyup(function(a){13==a.keyCode&&$("#login").click()}),e.emit("users"),e.on("userlist",function(b){a.activeusers=b})}]),angular.module("ChatClient").controller("RoomsController",["$scope","$location","$rootScope","$routeParams","socket",function(a,b,c,d,e){a.rooms=[],a.currentUser=d.user,a.hidden=!0,a.kickedmessage=!0,a.bannedmessage=!0,e.emit("rooms"),e.on("roomlist",function(b){for(var c in b)"lobby"!=c&&a.rooms.push(c)}),a.disco=function(){console.log("disconnecting"),e.emit("disco-net"),b.path("/login")},a.newRoom=function(){a.hidden=!a.hidden},a.submitRoom=function(){if(void 0!==a.roomname){var b={room:a.roomname};e.emit("joinroom",b,function(b,c){b||(a.errorMessage=c)}),$("#newRoom").val("")}},$("#newRoom").keyup(function(a){13==a.keyCode&&$("#submitRoom").click()}),e.on("updateRooms",function(b){void 0!==b&&a.rooms.push(b)}),d.user===c.sparkad&&(a.kickedmessage=!1,c.sparkad=void 0),d.user===c.bannad&&(a.bannedmessage=!1,c.bannad=void 0)}]),angular.module("ChatClient").controller("RoomController",["$scope","$location","$rootScope","$routeParams","socket",function(a,b,c,d,e){a.currentRoom=d.room,a.currentUser=d.user,a.currentUsers=[],a.errorMessage="",a.comment="",a.emptyComment="",a.commentHistory=[],a.hide=!0,a.errorPM="",a.pmHistory=[],a.selfkickbanopdeop="",a.oppedmessage="",a.deoppedmessage="",e.on("updateusers",function(b,c){b===a.currentRoom&&(a.currentUsers=c)}),e.on("updatechat",function(b,c){a.commentHistory=c});var f={room:a.currentRoom};e.emit("joinroom",f,function(d,e){d||(a.errorMessage=e,c.bannad=a.currentUser,b.path("/rooms/"+a.currentUser))}),a.addComment=function(){if(""===a.comment)a.emptyComment="Please write a comment!";else{var b={roomName:d.room,msg:a.comment};a.comment="",e.emit("sendmsg",b),$("#comment").val("")}},$("#comment").keyup(function(a){13==a.keyCode&&$("#addComment").click()}),a.returnLobby=function(){e.emit("partroom",a.currentRoom),b.path("/rooms/"+a.currentUser)},a.kickUser=function(b){var c=!1;if(b!==a.currentUser?c=window.confirm("Are you sure you want to kick "+b+"?"):a.selfkickbanopdeop="Unfortunately you can not kick your self out of the chat. Just leave the room if you wish to leave.",c===!0){var d={user:b,room:a.currentRoom};b!=a.currentUser&&e.emit("kick",d,function(b){b||(a.selfkickbanopdeop="Kick error occurred. Are you sure you are op")})}},e.on("kicked",function(d,e){e===a.currentUser&&(c.sparkad=e,b.path("/rooms/"+e))}),a.banUser=function(b){var c=!1;if(b!==a.currentUser?c=window.confirm("Do you want to ban "+b+" from the chat?"):a.selfkickbanopdeop="Unfortunately you can not ban your self. If you really want to be banned i suggest you op another user and then get him to ban you!",c===!0){var d={user:b,room:a.currentRoom};e.emit("ban",d,function(b){b||(a.selfkickbanopdeop="Error occured, only ops can ban people")})}},e.on("banned",function(d,e){e===a.currentUser&&(c.bannad=e,b.path("/rooms/"+e))}),a.opUser=function(b){var c=!1;if(b!==a.currentUser?c=window.confirm("do you want to op "+b+"?"):a.selfkickbanopdeop="Are you trying to op yourself? That's not going to happen.",c===!0){var d={user:b,room:a.currentRoom};e.emit("op",d,function(b){b||(a.selfkickbanopdeop="Error occured, only ops can op another users")})}},e.on("opped",function(b,c){c===a.currentUser&&(a.deoppedmessage="",a.oppedmessage="Congratulations! You are now officially an operator of this room. But remember, with great power comes great responsibility!")}),a.deopUser=function(b){var c=!1;if(b!==a.currentUser?c=window.confirm("you are about to deop "+b+". Are you sure you want to proceed? "+b+" will lose all op privileges."):a.selfkickbanopdeop="Trying to deop yourself? i suggest you just leave the chat and re-enter",c===!0){var d={user:b,room:a.currentRoom};e.emit("deop",d,function(b){b||(a.selfkickbanopdeop="Error occured, only ops can deop or maybe that user was never an op!")})}},e.on("deopped",function(b,c,d){c===a.currentUser&&(a.oppedmessage="",a.deoppedmessage="Unfortunately you've just been deopped by "+d+". If that seems unfair to you I suggest that you take it up with him. Why not send him a private message")}),a.sendPM=function(){if(""===a.pm)a.errorPM="Please write a comment!";else if(""===a.pmTo)a.errorPM="Please select a user";else{var b={nick:a.pmTo,message:a.pm};a.pm="",e.emit("privatemsg",b,function(b){b||(a.errorPM="Cannot send message")}),$("#pm").val("")}},e.on("recv_privatemsg",function(b,c){if(void 0!==b&&void 0!==c){var d={nick:b,message:c};a.pmHistory.push(d)}}),$("#pm").keyup(function(a){13==a.keyCode&&$("#sendPM").click()}),a.$on("ngRepeatFinished",function(){$(".chatlist").scrollTop($(".chatlist")[0].scrollHeight),$(".pmlist").scrollTop($(".pmlist")[0].scrollHeight)})}]);